---
title: "MultiGWAS Report "
output: 
 html_document:
    theme: cerulean
    toc: true
    number_sections: false
---

```{r include=FALSE,echo=FALSE}
library(knitr)
library(kableExtra)
```

```{r include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, echo=FALSE, warning=FALSE, message=FALSE)
cachedata = FALSE
cachemodels = FALSE
```
```{r echo=FALSE}
read_chunk('gwas-summary-markdown.R')
```
```{r echo=FALSE, message=FALSE}
<<loadLibraries>>
```
```{r echo=FALSE, message=FALSE}
<<msg>>
<<calculateInflationFactor>>
<<markersVennDiagrams>>
```
```{r echo=FALSE, message=FALSE}
<<initParams>>
```
```{r echo=FALSE, message=FALSE}
<<markersSummaryTable>>
snpsTables = markersSummaryTable (inputDir, gwasType, "Structure", outputDir,  nBEST)
```
# Input parameters
```{r  echo=FALSE, message=FALSE, warnings=TRUE}
<<getConfigurationParameters>>
paramsDF = getConfigurationParameters (inputDir)
kable (paramsDF) %>%
 	kable_styling(bootstrap_options = c("striped", "hover", "condensed", font_size=5))
```
# N best ranked SNPs
Venn diagram and table showing the N best ranked SNPs found by each tool and by more than one tool.

## Venn diagram
```{r echo=FALSE, message=FALSE, fig.width=5, fig.height=5, fig.fullwidth=TRUE}
<<markersVennDiagrams>>
scoresType = paste0("Best",nBEST)
outFilename = paste0(outputDir,"/out-summary-gwas-venndiagram-", scoresType, ".pdf")
commonBest = markersVennDiagrams (snpsTables$best, reportTitle, outputDir)
```

## Venn diagran (pdf)
```{r, fig.align = "center", echo=FALSE, message=FALSE, fig.width=5, fig.height=5, fig.fullwidth=TRUE}
knitr::include_graphics ("out/out-summary-gwas-venndiagram-Best7.png")
```

## SNPs table
```{r  echo=FALSE, message=FALSE}
kable (snpsTables$best) %>%
 	kable_styling(bootstrap_options = c("striped", "hover", "condensed", font_size=5))
```

# Significative SNPs
Venn diagram and table showing the signficative SNPs found by each tool and by more than one tool.

## Venn diagram
```{r echo=FALSE, message=FALSE, fig.width=5, fig.height=5, fig.fullwidth=TRUE}
<<markersVennDiagrams>>
scoresType = "Significatives"
outFilename = paste0(outputDir,"/out-summary-gwas-venndiagram-", scoresType, ".pdf")
commonSign = markersVennDiagrams (snpsTables$significatives, reportTitle, outputDir)
```

## SNPs table
```{r  echo=FALSE, message=FALSE}
kable (snpsTables$significatives) %>%
 	kable_styling(bootstrap_options = c("striped", "hover", "condensed", font_size=5))
```

# Manhattan and QQ Plots
Manhattan and QQ plots for the GWAS analysis of the four tools. 

 - The SNPs above the red line were found as significatives for each tool
 - The SNPs above the blue line correspond to the N best ranked SNPs for each tool
 - SNPs marked in green were found by more than one tool.
```{r  fig.widht=11, fig.height=20, fig.fullwidth=TRUE}
<<markersManhattanPlots>>
markersManhattanPlots (inputDir, gwasType, commonBest, commonSign, snpsTables$significatives, outputDir)
```
